<!DOCTYPE html> 
<html>
<head>
    <link rel="shortcut icon" href="{{STATIC_URL}}img/icon.png" >
	<title> {% block title %} 拼爱网{% endblock %} </title>
	{% load staticfiles %}
	<link href="{{STATIC_URL}}css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="{{STATIC_URL}}js/jquery.min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}js/bootstrap.min.js"></script>
    <link href="{{STATIC_URL}}css/footer&navbar.css" rel="stylesheet">
    <link href="{{STATIC_URL}}css/card.css" rel="stylesheet">
    <link href="{{STATIC_URL}}css/poplayer.css" rel="stylesheet">
    <script type="text/javascript" src="{{STATIC_URL}}js/jquery.poplayer.js"></script>
    <script src="{{STATIC_URL}}js/jquery.loading.js" type="text/javascript" charset="utf-8"></script>
	{% block staticfiles %}{% endblock %}
	{% block css %}{% endblock %}
</head> 
<body>
{% block logo %}
<header >
<div class="page_top">
			<div class="logo"><a href="/"><img alt="140x140" src="{{STATIC_URL}}img/logo.png"/></a></div>
</header>
{% endblock %}
{% block navigation %}
<header data-log="navi" class="header" id="header">
	<div class="header-inner">
		<h1 class="header-logo"></h1>
		<ul class="header-navi list-inline">
			<li id="home"><a href="/"> <span>推荐</span>
			</a></li>
			<li id="dynamic"><a href="/dynamic/"> <span>动态</span>
			</a></li>
			<li id="the_people_nearby"><a href="/the_people_nearby/the_people_nearby"> <span>附近的人</span>
			</a></li>
			<li id="search"><a href="/search/"> <span>用户搜索</span>
			</a> <em class="icon-recomm header-park-recomm"></em></li>
			<li id="game_pintu"><a href="/game/game_pintu/"> <span>缘分拼图</span>
			</a></li>
			<li id="member"><a href="/pay/member/"> <span>会员中心</span>
			</a></li>
		</ul>
		<div class="header-info js-header-info">
			<div class="header-info-mess js-info-mess glyphicon" id="message_icon" >
			<div id="count" class="notice" {%ifequal noReadCount 0%}style="display: none;"{%endifequal%}>
								{%ifequal noReadCount 0%}0{%else%}{{noReadCount}}{%endifequal%}
							</div>
				 <div id='count-list' class="header-info-list js-list" style="{%ifequal noReadCount 0%}display: none;{%endifequal%}">
					<ul>
						<li class="js-message" style="width: 80px;{%ifequal messageNoReadCount 0%}display: none;{%endifequal%}"  >
						  <a href="/message/no_read_message/">
						     <span>未读消息
						     <div id="messageCount" class="notice" style="left: 76px;" >
								{%ifequal messageNoReadCount 0%}0{%else%}{{messageNoReadCount}}{%endifequal%}
							</div>
							</span>
						  </a>
						</li>
						<li class="js-message" style="width: 80px;{%ifequal dynamicCommentCount 0%}display: none;{%endifequal%}">
						  <a href="/dynamic/no_read_coment/">
						     <span>未读评论
						     <div id="dynamicCommentCount" class="notice" style="left: 76px;" >
								{{dynamicCommentCount}}
							</div>
							</span>
						  </a>
						</li>
					</ul>
				</div>
			</div>
			</a>
			<div class="header-info-user js-info-user glyphicon ">
				<div class="header-info-list header-info-setting-list">
					<ul>
						<li><a href="/user/user_profile/#self_info"> <span>个人信息</span>
						</a></li>
						<li><a href="/user/change_password/"> <span>修改密码</span>
						</a></li>
						<li class="line"></li>
						<li><a href="/account/logout/" id="logOut"> <span>退出</span>
						</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</header>
<script type="text/javascript">
$(document).ready(function() {
	$('.indexFooter .bd-btn').click(function () {
		var UA = navigator.userAgent.toLowerCase(); 
		var footer = $('.indexFooter .footer-bd');
		if(footer.css('display')=='none'){
			footer.slideDown(400);
			$('.indexFooter .btn-icon').css({
				'border-color':'#363636 transparent transparent transparent',
				'top':'10px'
			});
			jQuery('html').animate({scrollTop:footer.offset().top},400);
			jQuery('body').animate({scrollTop:footer.offset().top},400);
		 
		}else{
			footer.slideUp(400);
			$('.indexFooter .btn-icon').css({
				'border-color':'transparent transparent #363636 transparent',
				'top':'-10px'
			});
		}
	});
	//点击信息图标事件
	$('#message_icon').click(function(){
		window.location.href='/message/'
	})
});

//切换导航栏
function change_navi(){
	pathname=window.location.pathname
	if(pathname=='/account/loggedin/'){
		$('#home').addClass('active')
	}else if(pathname=='/dynamic/'){
		$('#dynamic').addClass('active')
	}else if(pathname=='/the_people_nearby/the_people_nearby/'){
		$('#the_people_nearby').addClass('active')
	}else if(pathname=='/search/'){
		$('#search').addClass('active')
	}else if(pathname=='/game/game_pintu/'){
		$('#game_pintu').addClass('active')
	}else if(pathname=='/pay/member/'){
		$('#member').addClass('active');
	}
}
//拉取信息数量
var time=1000*1000;
interval = self.setInterval("polling()", time);
 var polling=function(){
	   $.getJSON('/newCount/',function(data){
		   if(data.result=='success'){
			   set_count(data.messageNoReadCount,data.dynamicCommentCount)
		   }else{
			   clearTimeout(interval)
		   }
			   });  
   };
   

function set_count(messageNoReadCount,dynamicCommentCount){
	if(messageNoReadCount==null){
		messageNoReadCount=get_no_read_message();
	}else if(dynamicCommentCount==null){
		dynamicCommentCount=get_no_read_dynamic_comment();
	}
	noReadCount=messageNoReadCount+dynamicCommentCount;
	set_no_read_message(messageNoReadCount);
	set_no_read_dynamic_comment(dynamicCommentCount);
	$('#count').html(noReadCount);
	if(noReadCount==0){
		$('#count,#count-list').hide();
	}else{
		$('#count,#count-list').show();
	}
}
function set_no_read_message(count){
	message=$('#messageCount');
	messageLi=message.closest('li');
	   messageCount=parseInt(message.html().trim());
	   if(messageCount!=count){
		   message.html(count);
		   messageLi.show();
	   }
	   if(count==0&&(message.is('hide')==false)){
		   messageLi.hide();
	   }
}
function get_no_read_message(){
	message=$('#messageCount');
	messageCount=parseInt(message.html().trim());
	return messageCount
};
function get_no_read_dynamic_comment(){
	dynamicComment=$('#dynamicCommentCount');
	dynamicCommentCount=parseInt(dynamicComment.html().trim());
	return dynamicCommentCount
};
function set_no_read_dynamic_comment(count){
	dynamicComment=$('#dynamicCommentCount');
	dynamicCommentLi=dynamicComment.closest('li')
	   dynamicCommentCount=parseInt(dynamicComment.html().trim());
	   if(dynamicCommentCount!=count){
		   dynamicComment.html(count);
		   dynamicCommentLi.show();
	   }
	   if(count==0&&(dynamicComment.is('hide')==false)){
		   dynamicCommentLi.hide();
	   }
}
</script>

{% endblock %}
{% block content %}{% endblock %}
{% block footer %}
<div class="indexFooter">
	<div class="bd-btn">
		<div class="btn-icon" style="border-color: transparent transparent rgb(54, 54, 54); top: -10px;"></div>
	</div>
	<div class="footer-bd" style="display: none;">
		<dl class="db-item">
			<dt class="item-title">
				<span style="background-color: #55AADE"></span> 友情链接
			</dt>
			<dd>
				<ul>
					<li><a href="#">拼爱网</a></li>
					<li><a href="#">拼爱网</a></li>
					<li><a href="#">拼爱网</a></li>
					<li><a href="#">拼爱网</a></li>
				</ul>
			</dd>
		</dl>

		<dl class="db-item">
			<dt class="item-title">
				<span></span> 手机客户端下载
			</dt>
			<dd>
				<div class="app android">Android客户端下载</div>
				<div class="app apple">iphone客户端下载</div>
			</dd>
		</dl>

		<dl class="db-item">
			<dt class="item-title">
				<span style="background-color: #56CC99;"></span> 关注我们
			</dt>
			<dd>
				<div class="follow"><a><img src="{{STATIC_URL}}img/weixin.jpg"/></a></div>
			</dd>
		</dl>
	</div>
	<div class="footer-ft">
		<div class="ft">
			<p>
				<a href="/web/">关于我们</a> - <a href="/web/#contactus">联系我们</a> - <a href="/web/#features_service">拼爱特色服务</a> -
				<a href="#">意见反馈</a> <span class="cRed"> Copyright &copy;
					2013-2018 版权所有&nbsp;&nbsp;&nbsp;&nbsp;浙ICP备14016914号</span>
			</p>
		</div>
	</div>
</div>
{% endblock %}
</body> 
</html> 