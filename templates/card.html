{% extends "base_later.html" %}
 {% load util_filter %}
	<title> {% block title %} 拼爱网--个人主页 {% endblock %} </title>
{% load staticfiles %}
{% block staticfiles %}
<link href="{{STATIC_URL}}css/venobox.css" rel="stylesheet">
<link href="{{STATIC_URL}}css/jquery.jscrollpane.css" rel="stylesheet">
<link href="{{STATIC_URL}}css/card.css" rel="stylesheet">
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.jscrollpane.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.mousewheel.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/venobox.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/Chart.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/Card.js"></script>

<script type="text/javascript">

//下一页
{% if pages.has_next %}
var next_page_number={{pages.next_page_number}}
{%else%}
var next_page_number=-1
{% endif %}
//上一页
{% if pages.has_previous %}
var previous_page_number={{pages.previous_page_number}}
{%else%}
var previous_page_number=-1
{% endif %}

//关注
var myFollow={{myFollow}}
var follow={{follow}}
var fans={{fans}}
$(document).ready(function(){
	if (previous_page_number<0){
		$('.prev').hide();
	}
	if(next_page_number<0){
		$('.next').hide();
	}
	//下一页
	$('.next').click(function(){
		
		var choseCardslist = new Array();　
		var choseCards=$('.card_row').children().not('.hideable').not('.controlArrow');
		var choseCardsSize=choseCards.length
		if (choseCardsSize>=8){
			alert('选中项大于等于8个')
		}
		if (choseCardsSize>0){
			for(i=0;i<choseCardsSize;i++){
				choseCardslist[i]=parseInt(choseCards[i].id)
			 }
		}
		var preCard = $('.card_row').children('.hideable');
		var size = preCard.hide('slow').removeClass('hideable').size();
		
		 $.getJSON(window.location.href,{ajax:true,page:next_page_number,choseCards:choseCardslist},function(data) {
			 if(data['result']=='success'){
				 if (data['has_next']){
					 next_page_number=data['next_page_number'];
				 }else{
					 next_page_number=-1;
					 $('.next').hide();
				 }
				 $('.prev').show();
				 previous_page_number=data['previous_page_number'];
				 var cards=data['cards'];
				 if  (data['removeCard']){
					 choseCardsSize=0
				 }
				 for(x=0;x<cards.length-choseCardsSize;x++){
						 new Card(new Person(cards[x].username,cards[x].age,cards[x].city,'/media/'+cards[x].avatar_name,cards[x].user_id,cards[x].followStatus,cards[x].heighScore, cards[x].incomeScore, cards[x].edcationScore, cards[x].appearanceScore, cards[x].characterScore));
					 } 
				 preCard.remove();
				 venobox();
			 }
		 });
	});
	
	//上一页
	$('.prev').click(function(){
		var choseCardslist = new Array();　
		var choseCards=$('.card_row').children().not('.hideable').not('.controlArrow');
		var choseCardsSize=choseCards.length
		if (choseCardsSize>=8){
			alert('选中项大于等于8个')
		}
		if (choseCardsSize>0){
			for(i=0;i<choseCardsSize;i++){
				choseCardslist[i]=parseInt(choseCards[i].id)
			 }
		}
		var nextCard = $('.card_row').children('.hideable');
		var size = nextCard.hide('slow').removeClass('hideable').size();
		//a = $('.card_row').children('.hideable').hide('slow').removeClass('hideable').size();
		 $.getJSON(window.location.href,{ajax:true,page:previous_page_number,choseCards:choseCardslist},function(data) {
			 if(data['result']=='success'){
				 if (data['has_previous']){
					 previous_page_number=data['previous_page_number'];
				 }else{
					 previous_page_number=-1;
					 $('.prev').hide();
				 }
				 next_page_number=data['next_page_number'];
				 $('.next').show();
				 var cards=data['cards'];
				 if  (data['removeCard']){
					 choseCardsSize=0
				 }
				 for(x=0;x<cards.length-choseCardsSize;x++){
					 new Card(new Person(cards[x].username,cards[x].age,cards[x].city,'/media/'+cards[x].avatar_name,cards[x].user_id,cards[x].followStatus,cards[x].heighScore, cards[x].incomeScore, cards[x].edcationScore, cards[x].appearanceScore, cards[x].characterScore));
					 } 
				 nextCard.remove();
				 venobox();
			 }
		 });
		
	});
	
	
	//获取卡片集合
	var cards =jQuery.parseJSON('{{pages.object_list|safe }}');
	init_card(cards);
	venobox();
	pane = $('.chat');
	pane.jScrollPane();
});
function init_card(cards){
	for(y=0;y<cards.length;y++){
		new Card(new Person(cards[y].username,cards[y].age,cards[y].city,'/media/'+cards[y].avatar_name,cards[y].user_id,cards[y].followStatus,cards[y].heighScore, cards[y].incomeScore, cards[y].edcationScore, cards[y].appearanceScore, cards[y].characterScore));
	}
};

function venobox(){
	$('.venobox').venobox({
		numeratio: true,
		border: '0'
	});
	$('.venoboxvid').venobox({
		bgcolor: '#000'
	});
	$('.venoboxframe').venobox({
		framewidth: '400px',
		frameheight: '551px',
		border: '6px',
	});
	$('.venoboxinline').venobox({
		framewidth: '300px',
		frameheight: '250px',
		border: '6px',
		bgcolor: '#f46f00'
	});
	$('.venoboxajax').venobox({
		framewidth: '400px',
		frameheight: '551px',
		border: '30px;'
	});
}

</script>

<script type="text/javascript" >

	
		
//拉取信息
/**
var userIdString=''
{% for page  in pages %}
    userIdString=userIdString+{{page.user_id}}+','
{% endfor %}  
  userIdString=userIdString.substring(0,userIdString.length-1)
var time=1000*10;
interval = self.setInterval("polling()", time);
 var polling=function(){
	   $.getJSON('/message/get_messge_by_id/',{userIdList:userIdString},function(data){
		   for(var message in data){
		    	  var api = pane.data('jsp');
					var chat = $('#chat_'+data[message].receiver_id).children().children();
					chat.append('<div class="chat_content_group other"><div class="chat_content">'+data[message].content+'<div class="cloudArrow "></div></div></div>');
					pane.jScrollPane();
					api.scrollTo(0,9999);
		      }

			   });  
   };
   **/
</script>

{% endblock %}
{% block css %}

{% endblock %}
{% block logo %}
{% endblock %}
{% block content %}
<header class="navbar">
  <div class="container" style="height:10px;">
    <div class="navbar-header">
    <a href='/'>
      <img alt="140x140" src="{{STATIC_URL}}img/logo.png"/>
    </a>  
    <span class="site_name">拼爱网</span>
    
    </div>
    <nav class="navigation">
      <ul class="nav navbar-nav">
        <li>
          <a href="/">推荐</a>
        </li>
        <li>
          <a href="/dynamic/">动态</a>
        </li>
        <li class="active">
          <a href="/the_people_nearby/the_people_nearby">附近的人</a>
        </li>
        <li>
          <a href="/search/simple_search/">用户搜索</a>
        </li>
        <li>
          <a href="/game/game_pintu/">缘分拼图</a>
        </li>
         <li>
          <a href="/account/logout/">注销</a>
        </li>
		<li>
          <a href="#">+</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
          <!-- <a href=".{{STATIC_URL}}about">关于</a> -->
        </li>
      </ul>
    </nav>
  </div>
</header>
<div class="container">
	<div class="row" style="margin-top:63px;">
		<div class="col-md-3">
			<div class="user_info card_panel"> 
				<div class="head head_boy" style="margin:4px;height:60px;width:60px;">
				<a href="/user/user_profile/"><img alt="140x140" src="{{MEDIA_URL}}{{avatar_name}}-60.jpeg"/></a>
				</div>
				<a href='/user/user_profile/#self_info'><div class="name">{{user.username}}</div></a>
				<hr/>
				<p style="margin:20px 0 20px 20px;">搬砖砌墙敲代码，只为买瓶哇哈哈。</p>
			</div>
			<div class="sns_info card_panel">
				<table class="table">
					<tbody>
					  <tr>
						<td><i class="icon_follow"></i></td>
						<td><a href="/user/follow/1">关注</a></td>
						<td><a id="myFollow" href="/user/follow/1">{{myFollow}}</a></td>
					  </tr>
					  <tr>
						<td><i class="icon_fans"></i></td>
						<td><a href="/user/follow/2">粉丝</a></td>
						<td><a id="fans" href="/user/follow/2">{{fans}}</a></td>
					  </tr>
					  <tr>
						<td><i class="icon_mutual_like"></i></td>
						<td><a href="/user/follow/3">相互关注</a></td>
						<td><a id="follow" href="/user/follow/3">{{follow}}</a></td>
					  </tr>
					</tbody>
				</table>
			</div>
			
			<div class="send_pic card_panel">
			</div>
		</div>
		<div class="col-md-9" style="height:550px;">
		<div id="compare_tip" class="alert alert-success alert-dismissable">
		  <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
		  点击其他用户<span class="text-danger"><strong>姓名</strong></span>进行对比。
		</div>
			<div class="row card_row" style="width:894px;">
			</div>
			<div class="controlArrow prev" title="上一页"></div>
			<div class="controlArrow next" title="下一页"></div>
		</div>
	</div>
</div>

<div id="card" style="display:none;">
<div class="card card_panel col-sm-6 hideable">
	    <div class="tabbable">
			<div class="tab-content">
				<div class="tab-pane active" id="tab12">
					<div class="introBox venoboxframe" data-type="iframe" href="">
					<div class="head head_girl">
						<img src="" alt="当前头像">
					</div>
						<div class="card-introBox" title="查看详细信息"><span class="detail_info">查看<br/>详细信息</span></div>
					</div>
					<div class="name other_name" title="22">
						<span class="name username"></span>
						<button class="compare_cancle btn btn-success">取消对比</button>
						<button class="compare btn btn-success">对比</button>
						<ul class="list-inline chart_info small">
							<li style="color:rgb(0,151,36)" class="name_self"></li>
							<li style="color:rgb(241,23,25)" class="name_other"></li>
						</ul>
						<canvas height="320" width="320"></canvas>
					</div>
					<hr />
				<div class="tag">
					<span>24岁</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<span>杭州</span>
				</div>
				<div class="tool_bar">
					<a href="#"><i class="icon_ding" title="固定"></i></a>
					<a href="#"><i class="icon_like_0" title="喜欢"></i></a>
					<a href="#"><i class="icon_dislike" title="不喜欢"></i></a>
				</div>
				</div>
				<div class="tab-pane" id="tab13">
					<div class="head head_girl min_head" style="margin-left:20px;margin-top:4px;height:60px;width:60px;display:inline-block;">
						<img alt="140x140" src=""/>
					</div>
					<span class="name username" style="position:absolute;top:10px;left:80px;"></span>
					<div class="scroller">
						<ul class="hoverbox" style="margin-left:22px;">
						</ul>
					</div>
				</div>
				<div class="tab-pane chat_tab" id="tab10">
					<div class="head head_girl min_head" style="margin-left:20px;margin-top:4px;height:60px;width:60px;display:inline-block;">
						<img alt="140x140" src=""/>
					</div>
					<span class="name username" style="position:absolute;top:10px;left:80px;"></span>
				<div class="chat">
				</div>
					<textarea rows="1" class="chat_textarea"></textarea>
					<button class="btn btn-xs btn_send_msg">发送</button> 
					<a href="#" class="venoboxframe" data-type="iframe">聊天记录</a>
				</div>
			</div>
			<ul class="list-inline card-nav">
				<li class="active"><a href="#tab12" data-toggle="tab" title="资料"><i class="icon_profile"></i></a></li>
				<li><a href="#tab13" data-toggle="tab"><i class="icon_photo" title="照片"></i></a></li>
				<li><a href="#tab10" data-toggle="tab"><i class="icon_msg" title="消息"></i></a></li>
			</ul>
		</div>
	</div>
</div>
{% endblock %}