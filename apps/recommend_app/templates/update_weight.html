<style type="text/css">
div.computerMove {
	position: absolute;
	top: -5px;
	width: 30px;
	height: 30px;
	background-color: #00CCCC;
	color: #FFFFFF;
	cursor: pointer;
	border-radius: 50%;
}

.progress {
	position: relative;
	margin-top: 50px;
	overflow: visible;
	width: 500px;
	border: solid 1px #000000;
}

.progress-bar-bule {
	background-color: #92E3FF;
}

.progress-bar-yellow {
	background-color: #FEF492;
}

.progress-bar-red {
	background-color: #FF8089;
}

.progress-bar-green {
	background-color: #C9FF73;
}

.progress-bar-purple {
	background-color: #CD94FF;
}

</style>
<SCRIPT>
    $(document).ready(function(){
    	      //提交权重

			 $("#update_weight").submit(function(){
				    
				     try{
	  				    var weightData=$(this).find('input')
	  				    var sum=0;
	  				    for (var i=0; i<weightData.length; i++){
	  				    	sum+=parseInt(weightData[i].value)
	  				    }
	  				    if (sum<100){
	  				    	var body = $("<p>权重总和需为100%!</p>")
							$.poplayer({body:body});
	  				    	return false;
	  				    }
	  				 }catch(msg){
	  				    	//alert('填写失误请重新填写！')
	  				    	return false;
	  				    }  
					var data=$(this).serialize();
					$.ajax({
                       type:'post',
                       url: "/recommend/update_weight/",
                       data:data,
                       success: function(data,textStatus){
                    	   data=$.parseJSON(data)
                    	   if(data.result== 'success'){
                    		   var body = $("<p>修改成功!</p>")
   							   $.poplayer({body:body});
                           }else if(data.result == 'error'){
                        	   var body = $("<p>"+data.msg+"</p>")
   							  $.poplayer({body:body});
                           }
                       },
                   
                   });
					  return false;
				});
		
    	//进度条
    	var progressWidth = $('.progress').css('width').split('p')[0];
        var total = 0;
        var $div = $("div.computerMove");
        /* 绑定鼠标左键按住事件 */
		$div.bind("mousedown",function(event){
			total = 0;
			var moveDiv = $(this);
				
			var progress = moveDiv.parent();
			
			$div.each(function(){
				if(!$(this).is(moveDiv)){
					total+=parseInt($(this).html().split('%')[0]);
				}
			});
			//total = total - moveDiv.html().split('%')[0];
			/* 获取需要拖动节点的坐标 */
			var offset_x = moveDiv[0].offsetLeft;//x坐标
			
			/* 获取当前鼠标的坐标 */
			var mouse_x = event.pageX;
			

			/* 绑定拖动事件 */
			/* 由于拖动时，可能鼠标会移出元素，所以应该使用全局（document）元素 */
			$(document).bind("mousemove",function(ev){
				/* 计算鼠标移动了的位置 */
				var _x = ev.pageX - mouse_x;
				
				/* 设置移动后的元素坐标 */
				var now_x = Math.round((offset_x + _x)/progressWidth*100);
				
				/* 改变目标元素的位置 */
				if(now_x>=0 && (_x<-5 || (now_x<=100 && total+now_x<=100))){
					moveDiv.css({
						left:now_x + "%"
					});
					progress.css({
						width:now_x + "%"
					});
					moveDiv.html(now_x+ "%");
					moveDiv.parent().find('input').attr('value',now_x)
					
					$('#_x').html((100-(total+now_x)) +'%');
				}
	
			});
		});
		/* 当鼠标左键松开，接触事件绑定 */
		$(document).bind("mouseup",function(){
			$(this).unbind("mousemove");
		});
	init_x()	
	})
	//初始化剩余值
	function init_x(){
    	var count=0;
    	var data=$('#update_weight').find('input');
    	for (i=0;i<data.length;i++){
    		count+=parseInt(data[i].value)
    	}
    	$('#_x').html(+(100-(count)) +'%');
    	
    }
</script>
<p>总分=身高权重*身高得分+外貌权重*外貌得分+学历权重*学历得分+外貌权重*收入得分+性格权重*性格得分</p>
<form id="update_weight" action="" menthod="post">
<ul style="float: left; list-style-type: none; color: #053B8D; font-size: 18px;">
	<li style="margin-top: 45px;">身高</li>
	<li style="margin-top: 45px;">相貌</li>
	<li style="margin-top: 45px;">收入</li>
	<li style="margin-top: 45px;">学历</li>
	<li style="margin-top: 45px;">性格</li>
	<li style="margin-top: 45px;" >剩余：</li>
</ul>
<div style="float: right; margin-right: 80px;">
	<div class="progress">
		<div class="progress-bar progress-bar-green" role="progressbar"
			aria-valuenow="80" aria-valuemin="{{heightweight}}" aria-valuemax="100"
			style="width:  {{heightweight}}%">
			<div class="computerMove" style="left: {{heightweight}}%;"  id="heightweight" > {{heightweight}}%</div>
			<input type="hidden" name="height" value="{{heightweight}}">
		</div>
	</div>
	<div class="progress">
		<div class="progress-bar progress-bar-purple" role="progressbar"
			aria-valuenow="20" aria-valuemin="{{appearanceweight}}" aria-valuemax="100"
			style="width: {{appearanceweight}}%">
			<div class="computerMove" style="left: {{appearanceweight}}%;">{{appearanceweight}}%</div>
			<input type="hidden" name="appearance" value="{{appearanceweight}}">
		</div>
	</div>
	<div class="progress">
		<div class="progress-bar progress-bar-bule" role="progressbar"
			aria-valuenow="60" aria-valuemin={{incomeweight}}" aria-valuemax="100"
			style="width: {{incomeweight}}%">
			<div class="computerMove" style="left: {{incomeweight}}%;">{{incomeweight}}%</div>
			<input type="hidden" name="income" value="{{incomeweight}}">
		</div>
	</div>
	<div class="progress">
		<div class="progress-bar progress-bar-yellow" role="progressbar"
			aria-valuenow="40" aria-valuemin="{{educationweight}}" aria-valuemax="100"
			style="width: {{educationweight}}%">
			<div class="computerMove" style="left: {{educationweight}}%;">{{educationweight}}%</div>
			<input type="hidden" name="education" value="{{educationweight}}">
		</div>
	</div>
	<div class="progress">
		<div class="progress-bar progress-bar-red" role="progressbar"
			aria-valuenow="20" aria-valuemin="{{characterweight}}" aria-valuemax="100"
			style="width: {{characterweight}}%">
			<div class="computerMove" style="left: {{characterweight}}%;">{{characterweight}}%</div>
			<input type="hidden" name="character" value="{{characterweight}}">
		</div>
	</div>

	<div id='_x'
		style="position: relative; top: 27px; color: #053B8D; font-size: 18px;">
		100%</div>
</div>
<button class="btn btn-pink btn-save">保存</button>
</form>	